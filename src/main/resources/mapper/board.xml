<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.enjoytrip.board.model.mapper.BoardMapper">
    <resultMap id="board" type="BoardDto">
        <result column="article_no" property="articleNo" />
        <result column="title" property="title" />
        <result column="content" property="content" />
        <result column="author" property="author" />
        <result column="write_date" property="writeDate" />
        <result column="update_date" property="updateDate" />
        <result column="type" property="type" />
        <result column="region_id" property="regionId" />
    </resultMap>

    <insert id="writeArticle" parameterType="BoardDto">
        insert into articles (title, content, author, type, region_id)
        values (#{title}, #{content}, #{author}, #{type}, #{regionId})
    </insert>

    <select id="listArticle" resultMap="board" resultType="BoardDto" parameterType="map">
        select title, content, author, write_date, update_date, type, region_id
        from articles
        <if test="type != null and type != ''">
            where type = #{type}
        </if>
    </select>

    <select id="selectByArticleNo" resultMap="board" resultType="BoardDto" parameterType="map">
        select article_no, title, content, author, write_date, update_date, type, region_id
        from articles
        where type = #{type} and article_no = #{articleNo}
    </select>

    <!--유저 일치 부분도 넣어야 함 추후 수정 예정-->
    <delete id="deleteArticle" parameterType="String">
        delete from articles
        where article_no=#{articleNo}
    </delete>

    <update id="updateArticle" parameterType="BoardDto">
        update articles
        set content = #{content}
        where article_no = #{articleNo}
    </update>

    <sql id="search">
        <if test="content != null and content != ''">
            <if test="key=='title'">
                and title like concat('%', #{content}, '%')
            </if>
            <if test="key != 'title'">
                and ${key} = #{content}
            </if>
        </if>
    </sql>

    <!--전체 article 개수 구하기-->
    <select id="getTotalArticleCount" parameterType="map" resultType="int">
        select count(article_no)
        from articles
        <where>
            <include refid="search"></include>
        </where>

    </select>

</mapper>